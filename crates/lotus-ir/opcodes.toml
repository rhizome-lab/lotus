# Opcode Schema for Reed
#
# This schema defines opcodes with dual-type system:
# - type_ts: TypeScript compile-time type (can include generics, mapped types, etc.)
# - type_runtime: Rust runtime type (String, Number, Bool, Object, Array, Null, Any)
#
# Runtime types are used for:
# - Rust code generation (builders, codegen modules)
# - Runtime validation and type checking
#
# TypeScript types are used for:
# - TypeScript type definitions
# - IDE autocomplete and type checking
# - Documentation generation

# ============================================================================
# std library - Core language constructs
# ============================================================================

[[opcode]]
name = "std.this"
category = "data"
description = "Current entity"
label = "This"
return_type_ts = "Entity"
return_type_runtime = "Object"

[[opcode]]
name = "std.caller"
category = "data"
description = "Current caller"
label = "Caller"
return_type_ts = "Entity"
return_type_runtime = "Object"

[[opcode]]
name = "std.seq"
category = "control_flow"
description = "Executes a sequence of steps and returns the result of the last step"
label = "Sequence"
lazy = true
variadic = true
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "...steps"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Steps to execute in sequence"

[[opcode]]
name = "std.let"
category = "variables"
description = "Creates a new variable in the current scope"
label = "Let"
lazy = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "name"
type_ts = "string"
type_runtime = "String"
description = "Variable name"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "Initial value"

[[opcode]]
name = "std.var"
category = "variables"
description = "Reads the value of a variable"
label = "Variable"
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "name"
type_ts = "string"
type_runtime = "String"
description = "Variable name"

[[opcode]]
name = "std.set"
category = "variables"
description = "Sets the value of an existing variable"
label = "Set"
lazy = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "name"
type_ts = "string"
type_runtime = "String"
description = "Variable name"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "New value"

[[opcode]]
name = "std.if"
category = "control_flow"
description = "Conditional execution"
label = "If"
lazy = true
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "condition"
type_ts = "boolean"
type_runtime = "Bool"
description = "Condition to evaluate"

[[opcode.params]]
name = "then"
type_ts = "any"
type_runtime = "Any"
description = "Expression to execute if condition is true"

[[opcode.params]]
name = "else"
type_ts = "any"
type_runtime = "Any"
description = "Expression to execute if condition is false"
optional = true

[[opcode]]
name = "std.while"
category = "control_flow"
description = "While loop"
label = "While"
lazy = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "condition"
type_ts = "boolean"
type_runtime = "Bool"
description = "Condition to evaluate each iteration"

[[opcode.params]]
name = "body"
type_ts = "any"
type_runtime = "Any"
description = "Loop body to execute"

[[opcode]]
name = "std.for"
category = "control_flow"
description = "For-each loop over an iterable"
label = "For"
lazy = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "variable"
type_ts = "string"
type_runtime = "String"
description = "Loop variable name"

[[opcode.params]]
name = "iterable"
type_ts = "any[]"
type_runtime = "Array"
description = "Array to iterate over"

[[opcode.params]]
name = "body"
type_ts = "any"
type_runtime = "Any"
description = "Loop body to execute"

[[opcode]]
name = "std.break"
category = "control_flow"
description = "Break out of a loop"
label = "Break"
return_type_ts = "never"
return_type_runtime = "Null"

[[opcode]]
name = "std.continue"
category = "control_flow"
description = "Continue to next loop iteration"
label = "Continue"
return_type_ts = "never"
return_type_runtime = "Null"

[[opcode]]
name = "std.return"
category = "control_flow"
description = "Return a value from the current function"
label = "Return"
return_type_ts = "never"
return_type_runtime = "Any"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "Value to return"
optional = true

[[opcode]]
name = "std.arg"
category = "data"
description = "Get argument by index"
label = "Argument"
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "index"
type_ts = "number"
type_runtime = "Number"
description = "Zero-based argument index"

[[opcode]]
name = "std.args"
category = "data"
description = "Get all arguments as an array"
label = "Arguments"
return_type_ts = "any[]"
return_type_runtime = "Array"

[[opcode]]
name = "std.lambda"
category = "function"
description = "Create an anonymous function"
label = "Lambda"
lazy = true
return_type_ts = "(...args: any[]) => any"
return_type_runtime = "Any"

[[opcode.params]]
name = "params"
type_ts = "string[]"
type_runtime = "Array"
description = "Parameter names"

[[opcode.params]]
name = "body"
type_ts = "any"
type_runtime = "Any"
description = "Function body"

[[opcode]]
name = "std.apply"
category = "function"
description = "Apply a function to arguments"
label = "Apply"
variadic = true
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "function"
type_ts = "(...args: any[]) => any"
type_runtime = "Any"
description = "Function to call"

[[opcode.params]]
name = "...args"
type_ts = "any[]"
type_runtime = "Array"
description = "Arguments to pass"

[[opcode]]
name = "std.quote"
category = "meta"
description = "Return the raw S-expression without evaluating"
label = "Quote"
lazy = true
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "expression"
type_ts = "any"
type_runtime = "Any"
description = "Expression to quote"

[[opcode]]
name = "std.typeof"
category = "type"
description = "Get the type of a value as a string"
label = "Type Of"
return_type_ts = "'string' | 'number' | 'boolean' | 'object' | 'array' | 'function' | 'null'"
return_type_runtime = "String"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "Value to get type of"

[[opcode]]
name = "std.string"
category = "type"
description = "Convert a value to string"
label = "To String"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "Value to convert"

[[opcode]]
name = "std.number"
category = "type"
description = "Convert a value to number"
label = "To Number"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "Value to convert"

[[opcode]]
name = "std.boolean"
category = "type"
description = "Convert a value to boolean"
label = "To Boolean"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "Value to convert"

[[opcode]]
name = "std.throw"
category = "error"
description = "Throw an error"
label = "Throw"
return_type_ts = "never"
return_type_runtime = "Null"

[[opcode.params]]
name = "message"
type_ts = "string"
type_runtime = "String"
description = "Error message"

[[opcode]]
name = "std.try"
category = "error"
description = "Try to execute an expression, catching errors"
label = "Try"
lazy = true
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "body"
type_ts = "any"
type_runtime = "Any"
description = "Expression to try"

[[opcode.params]]
name = "catch"
type_ts = "(error: any) => any"
type_runtime = "Any"
description = "Error handler function"
optional = true

[[opcode]]
name = "std.log"
category = "io"
description = "Log values to stdout"
label = "Log"
variadic = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "...values"
type_ts = "any[]"
type_runtime = "Array"
description = "Values to log"

[[opcode]]
name = "std.warn"
category = "io"
description = "Log values to stderr as warning"
label = "Warn"
variadic = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "...values"
type_ts = "any[]"
type_runtime = "Array"
description = "Values to log"

# ============================================================================
# obj library - Object operations
# ============================================================================

[[opcode]]
name = "obj.get"
category = "object"
description = "Gets a property value from an object"
label = "Get Property"
generics = ["Type", "Key extends keyof Type"]
return_type_ts = "Type[Key]"
return_type_runtime = "Any"

[[opcode.params]]
name = "object"
type_ts = "Type"
type_runtime = "Object"
description = "The object to get property from"

[[opcode.params]]
name = "key"
type_ts = "Key"
type_runtime = "String"
description = "Property key"

[[opcode.slot]]
name = "Object"
type = "block"

[[opcode.slot]]
name = "Key"
type = "block"

[[opcode]]
name = "obj.set"
category = "object"
description = "Sets a property value on an object"
label = "Set Property"
lazy = true
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "The object to set property on"

[[opcode.params]]
name = "key"
type_ts = "string"
type_runtime = "String"
description = "Property key"

[[opcode.params]]
name = "value"
type_ts = "any"
type_runtime = "Any"
description = "New value"

[[opcode]]
name = "obj.keys"
category = "object"
description = "Returns an array of a given object's own enumerable property names"
label = "Keys"
generics = ["Type"]
return_type_ts = "readonly (keyof Type)[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "object"
type_ts = "Type"
type_runtime = "Object"
description = "The object to get keys from"

[[opcode.slot]]
name = "Object"
type = "block"

[[opcode]]
name = "obj.values"
category = "object"
description = "Returns an array of a given object's own enumerable property values"
label = "Values"
generics = ["Type"]
return_type_ts = "Type[keyof Type][]"
return_type_runtime = "Array"

[[opcode.params]]
name = "object"
type_ts = "Type"
type_runtime = "Object"
description = "The object to get values from"

[[opcode.slot]]
name = "Object"
type = "block"

[[opcode]]
name = "obj.new"
category = "object"
description = "Creates a new object from key-value pairs"
label = "New Object"
variadic = true
return_type_ts = "object"
return_type_runtime = "Object"

[[opcode.params]]
name = "...pairs"
type_ts = "[string, any][]"
type_runtime = "Array"
description = "Key-value pairs"

[[opcode]]
name = "obj.has"
category = "object"
description = "Checks if an object has a property"
label = "Has"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to check"

[[opcode.params]]
name = "key"
type_ts = "string"
type_runtime = "String"
description = "Property key"

[[opcode]]
name = "obj.delete"
category = "object"
description = "Deletes a property from an object"
label = "Delete"
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to modify"

[[opcode.params]]
name = "key"
type_ts = "string"
type_runtime = "String"
description = "Property key to delete"

[[opcode]]
name = "obj.del"
category = "object"
description = "Deletes a property and returns whether it existed"
label = "Delete"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to modify"

[[opcode.params]]
name = "key"
type_ts = "string"
type_runtime = "String"
description = "Property key to delete"

[[opcode]]
name = "obj.merge"
category = "object"
description = "Merges two objects into a new object"
label = "Merge"
return_type_ts = "object"
return_type_runtime = "Object"

[[opcode.params]]
name = "object1"
type_ts = "object"
type_runtime = "Object"
description = "First object"

[[opcode.params]]
name = "object2"
type_ts = "object"
type_runtime = "Object"
description = "Second object (properties override first)"

[[opcode]]
name = "obj.entries"
category = "object"
description = "Returns an array of key-value pairs"
label = "Entries"
generics = ["Type"]
return_type_ts = "[keyof Type, Type[keyof Type]][]"
return_type_runtime = "Array"

[[opcode.params]]
name = "object"
type_ts = "Type"
type_runtime = "Object"
description = "Object to get entries from"

[[opcode]]
name = "obj.map"
category = "object"
description = "Maps object values through a function"
label = "Map"
return_type_ts = "object"
return_type_runtime = "Object"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to map"

[[opcode.params]]
name = "function"
type_ts = "(value: any, key: string) => any"
type_runtime = "Any"
description = "Mapping function"

[[opcode]]
name = "obj.filter"
category = "object"
description = "Filters object entries by a predicate"
label = "Filter"
return_type_ts = "object"
return_type_runtime = "Object"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to filter"

[[opcode.params]]
name = "predicate"
type_ts = "(value: any, key: string) => boolean"
type_runtime = "Any"
description = "Filter predicate"

[[opcode]]
name = "obj.reduce"
category = "object"
description = "Reduces object entries to a single value"
label = "Reduce"
return_type_ts = "any"
return_type_runtime = "Any"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to reduce"

[[opcode.params]]
name = "reducer"
type_ts = "(accumulator: any, value: any, key: string) => any"
type_runtime = "Any"
description = "Reducer function"

[[opcode.params]]
name = "initialValue"
type_ts = "any"
type_runtime = "Any"
description = "Initial accumulator value"

[[opcode]]
name = "obj.flatMap"
category = "object"
description = "Maps object entries and flattens the result"
label = "FlatMap"
return_type_ts = "object"
return_type_runtime = "Object"

[[opcode.params]]
name = "object"
type_ts = "object"
type_runtime = "Object"
description = "Object to flatMap"

[[opcode.params]]
name = "function"
type_ts = "(value: any, key: string) => object"
type_runtime = "Any"
description = "Mapping function returning objects to merge"

# ============================================================================
# str library - String operations
# ============================================================================

[[opcode]]
name = "str.concat"
category = "string"
description = "Concatenates strings"
label = "Concat"
variadic = true
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "...strings"
type_ts = "(string | number | boolean | null)[]"
type_runtime = "Array"
description = "Values to concatenate as strings"

[[opcode]]
name = "str.len"
category = "string"
description = "Returns the length of a string"
label = "Length"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "Input string"

[[opcode]]
name = "str.lower"
category = "string"
description = "Converts a string to lowercase"
label = "To Lower"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to convert"

[[opcode]]
name = "str.upper"
category = "string"
description = "Converts a string to uppercase"
label = "To Upper"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to convert"

[[opcode]]
name = "str.trim"
category = "string"
description = "Removes whitespace from both ends of a string"
label = "Trim"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to trim"

[[opcode]]
name = "str.split"
category = "string"
description = "Splits a string into an array of substrings using a separator"
label = "Split"
return_type_ts = "string[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to split"

[[opcode.params]]
name = "separator"
type_ts = "string"
type_runtime = "String"
description = "Separator to split by"

[[opcode]]
name = "str.slice"
category = "string"
description = "Extracts a section of a string and returns it as a new string"
label = "Slice"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to slice"

[[opcode.params]]
name = "start"
type_ts = "number"
type_runtime = "Number"
description = "Start index"

[[opcode.params]]
name = "end"
type_ts = "number"
type_runtime = "Number"
description = "End index (exclusive)"
optional = true

[[opcode]]
name = "str.sub"
category = "string"
description = "Extracts a substring between start and end indices"
label = "Substring"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "Input string"

[[opcode.params]]
name = "start"
type_ts = "number"
type_runtime = "Number"
description = "Start index"

[[opcode.params]]
name = "end"
type_ts = "number"
type_runtime = "Number"
description = "End index"

[[opcode]]
name = "str.replace"
category = "string"
description = "Replaces the first occurrence of a substring with another string"
label = "Replace"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to search in"

[[opcode.params]]
name = "search"
type_ts = "string"
type_runtime = "String"
description = "String to search for"

[[opcode.params]]
name = "replacement"
type_ts = "string"
type_runtime = "String"
description = "String to replace with"

[[opcode]]
name = "str.includes"
category = "string"
description = "Checks if a string contains another string"
label = "Includes"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to check"

[[opcode.params]]
name = "search"
type_ts = "string"
type_runtime = "String"
description = "Substring to search for"

[[opcode]]
name = "str.indexOf"
category = "string"
description = "Returns the index of the first occurrence of a substring, or -1"
label = "Index Of"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to search in"

[[opcode.params]]
name = "search"
type_ts = "string"
type_runtime = "String"
description = "Substring to search for"

[[opcode]]
name = "str.startsWith"
category = "string"
description = "Checks if a string starts with a given prefix"
label = "Starts With"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to check"

[[opcode.params]]
name = "prefix"
type_ts = "string"
type_runtime = "String"
description = "Prefix to check for"

[[opcode]]
name = "str.endsWith"
category = "string"
description = "Checks if a string ends with a given suffix"
label = "Ends With"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to check"

[[opcode.params]]
name = "suffix"
type_ts = "string"
type_runtime = "String"
description = "Suffix to check for"

[[opcode]]
name = "str.repeat"
category = "string"
description = "Returns a string with the original repeated n times"
label = "Repeat"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "string"
type_ts = "string"
type_runtime = "String"
description = "String to repeat"

[[opcode.params]]
name = "count"
type_ts = "number"
type_runtime = "Number"
description = "Number of times to repeat"

[[opcode]]
name = "str.join"
category = "string"
description = "Joins elements of a list into a string using a separator"
label = "Join"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "list"
type_ts = "any[]"
type_runtime = "Array"
description = "List to join"

[[opcode.params]]
name = "separator"
type_ts = "string"
type_runtime = "String"
description = "Separator string"

# ============================================================================
# math library - Mathematical operations
# ============================================================================

[[opcode]]
name = "math.add"
category = "math"
description = "Adds numbers"
label = "Add"
variadic = true
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "...numbers"
type_ts = "number[]"
type_runtime = "Array"
description = "Numbers to add"

[[opcode]]
name = "math.sub"
category = "math"
description = "Subtracts numbers"
label = "Subtract"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "Left operand"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Right operand"

[[opcode]]
name = "math.mul"
category = "math"
description = "Multiplies numbers"
label = "Multiply"
variadic = true
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "...numbers"
type_ts = "number[]"
type_runtime = "Array"
description = "Numbers to multiply"

[[opcode]]
name = "math.div"
category = "math"
description = "Divides numbers"
label = "Divide"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "Dividend"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Divisor"

[[opcode]]
name = "math.mod"
category = "math"
description = "Calculates the modulo of two numbers"
label = "Modulo"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "Dividend"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Divisor"

[[opcode]]
name = "math.pow"
category = "math"
description = "Calculates exponentiation (power tower)"
label = "Power"
variadic = true
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "base"
type_ts = "number"
type_runtime = "Number"
description = "Base number"

[[opcode.params]]
name = "exp"
type_ts = "number"
type_runtime = "Number"
description = "Exponent"

[[opcode.params]]
name = "...args"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional exponents for power tower"
optional = true

[[opcode]]
name = "math.floor"
category = "math"
description = "Rounds down a number"
label = "Floor"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number to floor"

[[opcode]]
name = "math.ceil"
category = "math"
description = "Rounds up a number"
label = "Ceiling"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number to ceil"

[[opcode]]
name = "math.trunc"
category = "math"
description = "Returns the integer part of a number"
label = "Truncate"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number to truncate"

[[opcode]]
name = "math.round"
category = "math"
description = "Rounds a number to the nearest integer"
label = "Round"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number to round"

[[opcode]]
name = "math.sin"
category = "math"
description = "Returns the sine of an angle in radians"
label = "Sine"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "angle"
type_ts = "number"
type_runtime = "Number"
description = "Angle in radians"

[[opcode]]
name = "math.cos"
category = "math"
description = "Returns the cosine of an angle in radians"
label = "Cosine"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "angle"
type_ts = "number"
type_runtime = "Number"
description = "Angle in radians"

[[opcode]]
name = "math.tan"
category = "math"
description = "Returns the tangent of an angle in radians"
label = "Tangent"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "angle"
type_ts = "number"
type_runtime = "Number"
description = "Angle in radians"

[[opcode]]
name = "math.asin"
category = "math"
description = "Returns the arcsine of a number"
label = "Arcsine"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number between -1 and 1"

[[opcode]]
name = "math.acos"
category = "math"
description = "Returns the arccosine of a number"
label = "Arccosine"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number between -1 and 1"

[[opcode]]
name = "math.atan"
category = "math"
description = "Returns the arctangent of a number"
label = "Arctangent"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

[[opcode]]
name = "math.atan2"
category = "math"
description = "Returns the angle from the X axis to a point"
label = "Atan2"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "dy"
type_ts = "number"
type_runtime = "Number"
description = "Y coordinate"

[[opcode.params]]
name = "dx"
type_ts = "number"
type_runtime = "Number"
description = "X coordinate"

[[opcode]]
name = "math.log"
category = "math"
description = "Returns the natural logarithm (base e) of a number"
label = "Natural Log"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

[[opcode]]
name = "math.log2"
category = "math"
description = "Returns the base 2 logarithm of a number"
label = "Log Base 2"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

[[opcode]]
name = "math.log10"
category = "math"
description = "Returns the base 10 logarithm of a number"
label = "Log Base 10"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

[[opcode]]
name = "math.exp"
category = "math"
description = "Returns e raised to the power of a number"
label = "Exponential"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Exponent"

[[opcode]]
name = "math.sqrt"
category = "math"
description = "Returns the square root of a number"
label = "Square Root"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

[[opcode]]
name = "math.abs"
category = "math"
description = "Returns the absolute value of a number"
label = "Absolute"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

[[opcode]]
name = "math.min"
category = "math"
description = "Returns the smallest of the given numbers"
label = "Minimum"
variadic = true
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "first"
type_ts = "number"
type_runtime = "Number"
description = "First number"

[[opcode.params]]
name = "...args"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional numbers"
optional = true

[[opcode]]
name = "math.max"
category = "math"
description = "Returns the largest of the given numbers"
label = "Maximum"
variadic = true
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "first"
type_ts = "number"
type_runtime = "Number"
description = "First number"

[[opcode.params]]
name = "...args"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional numbers"
optional = true

[[opcode]]
name = "math.clamp"
category = "math"
description = "Clamps a number between a minimum and maximum value"
label = "Clamp"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "value"
type_ts = "number"
type_runtime = "Number"
description = "Value to clamp"

[[opcode.params]]
name = "min"
type_ts = "number"
type_runtime = "Number"
description = "Minimum value"

[[opcode.params]]
name = "max"
type_ts = "number"
type_runtime = "Number"
description = "Maximum value"

[[opcode]]
name = "math.sign"
category = "math"
description = "Returns the sign of a number (-1, 0, or 1)"
label = "Sign"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "num"
type_ts = "number"
type_runtime = "Number"
description = "Number"

# ============================================================================
# list library - Array operations
# ============================================================================

[[opcode]]
name = "list.new"
category = "list"
description = "Creates a new list from elements"
label = "New List"
lazy = true
variadic = true
generics = ["Elements extends readonly unknown[]"]
return_type_ts = "[...Elements]"
return_type_runtime = "Array"

[[opcode.params]]
name = "...elements"
type_ts = "Elements"
type_runtime = "Array"
description = "Elements to include in the list"

[[opcode]]
name = "list.get"
category = "list"
description = "Gets an element from a list by index"
label = "Get Element"
generics = ["T"]
return_type_ts = "T"
return_type_runtime = "Any"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "The list to get element from"

[[opcode.params]]
name = "index"
type_ts = "number"
type_runtime = "Number"
description = "Zero-based index"

[[opcode]]
name = "list.len"
category = "list"
description = "Returns the length of a list"
label = "Length"
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "list"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Input list"

[[opcode]]
name = "list.set"
category = "list"
description = "Sets an element in a list at a specific index"
label = "Set Element"
generics = ["T"]
return_type_ts = "T"
return_type_runtime = "Any"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to modify"

[[opcode.params]]
name = "index"
type_ts = "number"
type_runtime = "Number"
description = "Zero-based index"

[[opcode.params]]
name = "value"
type_ts = "T"
type_runtime = "Any"
description = "Value to set"

[[opcode]]
name = "list.push"
category = "list"
description = "Adds an item to the end of a list"
label = "Push"
generics = ["T"]
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to modify"

[[opcode.params]]
name = "value"
type_ts = "T"
type_runtime = "Any"
description = "Value to push"

[[opcode]]
name = "list.pop"
category = "list"
description = "Removes and returns the last item of a list"
label = "Pop"
generics = ["T"]
return_type_ts = "T | undefined"
return_type_runtime = "Any"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to modify"

[[opcode]]
name = "list.unshift"
category = "list"
description = "Adds an item to the beginning of a list"
label = "Unshift"
generics = ["T"]
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to modify"

[[opcode.params]]
name = "value"
type_ts = "T"
type_runtime = "Any"
description = "Value to add at the beginning"

[[opcode]]
name = "list.shift"
category = "list"
description = "Removes and returns the first item of a list"
label = "Shift"
generics = ["T"]
return_type_ts = "T | undefined"
return_type_runtime = "Any"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to modify"

[[opcode]]
name = "list.slice"
category = "list"
description = "Returns a shallow copy of a portion of a list"
label = "Slice"
generics = ["T"]
return_type_ts = "T[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to slice"

[[opcode.params]]
name = "start"
type_ts = "number"
type_runtime = "Number"
description = "Start index (inclusive)"

[[opcode.params]]
name = "end"
type_ts = "number"
type_runtime = "Number"
description = "End index (exclusive)"

[[opcode]]
name = "list.splice"
category = "list"
description = "Changes contents by removing or replacing elements and/or adding new elements"
label = "Splice"
generics = ["T"]
variadic = true
return_type_ts = "T[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to modify"

[[opcode.params]]
name = "start"
type_ts = "number"
type_runtime = "Number"
description = "Start index"

[[opcode.params]]
name = "deleteCount"
type_ts = "number"
type_runtime = "Number"
description = "Number of items to remove"

[[opcode.params]]
name = "...items"
type_ts = "T[]"
type_runtime = "Array"
description = "Items to add"
optional = true

[[opcode]]
name = "list.concat"
category = "list"
description = "Merges two lists into a new list"
label = "Concat"
generics = ["T"]
return_type_ts = "T[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list1"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "First list"

[[opcode.params]]
name = "list2"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "Second list"

[[opcode]]
name = "list.empty"
category = "list"
description = "Checks if a list is empty"
label = "Is Empty"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "list"
type_ts = "readonly unknown[]"
type_runtime = "Array"
description = "List to check"

[[opcode]]
name = "list.includes"
category = "list"
description = "Determines whether a list includes a certain value"
label = "Includes"
generics = ["T"]
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to search"

[[opcode.params]]
name = "value"
type_ts = "T"
type_runtime = "Any"
description = "Value to search for"

[[opcode]]
name = "list.indexOf"
category = "list"
description = "Returns the first index at which a value can be found, or -1 if not present"
label = "Index Of"
generics = ["T"]
return_type_ts = "number"
return_type_runtime = "Number"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to search"

[[opcode.params]]
name = "value"
type_ts = "T"
type_runtime = "Any"
description = "Value to search for"

[[opcode]]
name = "list.reverse"
category = "list"
description = "Reverses a list in place"
label = "Reverse"
generics = ["T"]
return_type_ts = "T[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to reverse"

[[opcode]]
name = "list.sort"
category = "list"
description = "Sorts the elements of a list in place"
label = "Sort"
generics = ["T"]
return_type_ts = "T[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "T[]"
type_runtime = "Array"
description = "List to sort"

[[opcode]]
name = "list.join"
category = "list"
description = "Joins all elements of a list into a string"
label = "Join"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "list"
type_ts = "readonly unknown[]"
type_runtime = "Array"
description = "List to join"

[[opcode.params]]
name = "separator"
type_ts = "string"
type_runtime = "String"
description = "Separator string"

[[opcode]]
name = "list.find"
category = "list"
description = "Returns the first element that satisfies the provided testing function"
label = "Find"
generics = ["T"]
return_type_ts = "T | undefined"
return_type_runtime = "Any"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to search"

[[opcode.params]]
name = "predicate"
type_ts = "(value: T, index: number) => boolean"
type_runtime = "Any"
description = "Testing function"

[[opcode]]
name = "list.map"
category = "list"
description = "Creates a new list with the results of calling a function on every element"
label = "Map"
generics = ["T", "U"]
return_type_ts = "U[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to map"

[[opcode.params]]
name = "mapper"
type_ts = "(value: T, index: number) => U"
type_runtime = "Any"
description = "Mapping function"

[[opcode]]
name = "list.filter"
category = "list"
description = "Creates a new list with elements that pass the test"
label = "Filter"
generics = ["T"]
return_type_ts = "T[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to filter"

[[opcode.params]]
name = "predicate"
type_ts = "(value: T, index: number) => boolean"
type_runtime = "Any"
description = "Testing function"

[[opcode]]
name = "list.reduce"
category = "list"
description = "Executes a reducer function on each element, resulting in a single output value"
label = "Reduce"
generics = ["T", "U"]
return_type_ts = "U"
return_type_runtime = "Any"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to reduce"

[[opcode.params]]
name = "reducer"
type_ts = "(accumulator: U, value: T, index: number) => U"
type_runtime = "Any"
description = "Reducer function"

[[opcode.params]]
name = "initialValue"
type_ts = "U"
type_runtime = "Any"
description = "Initial accumulator value"

[[opcode]]
name = "list.flatMap"
category = "list"
description = "Maps each element using a function, then flattens the result by one level"
label = "FlatMap"
generics = ["T", "U"]
return_type_ts = "U[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "list"
type_ts = "readonly T[]"
type_runtime = "Array"
description = "List to flatMap"

[[opcode.params]]
name = "mapper"
type_ts = "(value: T, index: number) => U | U[]"
type_runtime = "Any"
description = "Mapping function"

# ============================================================================
# bool library - Boolean operations
# ============================================================================

[[opcode]]
name = "bool.and"
category = "bool"
description = "Logical AND"
label = "And"
lazy = true
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "...operands"
type_ts = "boolean[]"
type_runtime = "Array"
description = "Boolean values to AND"

[[opcode]]
name = "bool.or"
category = "bool"
description = "Logical OR"
label = "Or"
lazy = true
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "...operands"
type_ts = "boolean[]"
type_runtime = "Array"
description = "Boolean values to OR"

[[opcode]]
name = "bool.not"
category = "bool"
description = "Logical NOT"
label = "Not"
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "value"
type_ts = "boolean"
type_runtime = "Bool"
description = "Boolean value to negate"

[[opcode]]
name = "bool.eq"
category = "bool"
description = "Checks if all arguments are equal"
label = "Equals"
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "left"
type_ts = "unknown"
type_runtime = "Any"
description = "First value"

[[opcode.params]]
name = "right"
type_ts = "unknown"
type_runtime = "Any"
description = "Second value"

[[opcode.params]]
name = "...rest"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Additional values to compare"
optional = true

[[opcode]]
name = "bool.neq"
category = "bool"
description = "Checks if adjacent arguments are different"
label = "Not Equals"
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "left"
type_ts = "unknown"
type_runtime = "Any"
description = "First value"

[[opcode.params]]
name = "right"
type_ts = "unknown"
type_runtime = "Any"
description = "Second value"

[[opcode.params]]
name = "...rest"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Additional values to compare"
optional = true

[[opcode]]
name = "bool.lt"
category = "bool"
description = "Checks if arguments are strictly increasing"
label = "Less Than"
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "First number"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Second number"

[[opcode.params]]
name = "...rest"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional numbers"
optional = true

[[opcode]]
name = "bool.lte"
category = "bool"
description = "Checks if arguments are non-decreasing"
label = "Less Than or Equal"
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "First number"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Second number"

[[opcode.params]]
name = "...rest"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional numbers"
optional = true

[[opcode]]
name = "bool.gt"
category = "bool"
description = "Checks if arguments are strictly decreasing"
label = "Greater Than"
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "First number"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Second number"

[[opcode.params]]
name = "...rest"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional numbers"
optional = true

[[opcode]]
name = "bool.gte"
category = "bool"
description = "Checks if arguments are non-increasing"
label = "Greater Than or Equal"
variadic = true
return_type_ts = "boolean"
return_type_runtime = "Bool"

[[opcode.params]]
name = "left"
type_ts = "number"
type_runtime = "Number"
description = "First number"

[[opcode.params]]
name = "right"
type_ts = "number"
type_runtime = "Number"
description = "Second number"

[[opcode.params]]
name = "...rest"
type_ts = "number[]"
type_runtime = "Array"
description = "Additional numbers"
optional = true

[[opcode]]
name = "bool.nullish"
category = "bool"
description = "Nullish coalescing - returns first non-null/undefined value"
label = "Nullish"
lazy = true
variadic = true
return_type_ts = "unknown"
return_type_runtime = "Any"

[[opcode.params]]
name = "left"
type_ts = "unknown"
type_runtime = "Any"
description = "First value"

[[opcode.params]]
name = "right"
type_ts = "unknown"
type_runtime = "Any"
description = "Second value"

[[opcode.params]]
name = "...rest"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Additional values"
optional = true

[[opcode]]
name = "bool.guard"
category = "bool"
description = "Short-circuiting AND - returns first falsy value or the last value"
label = "Guard"
lazy = true
variadic = true
return_type_ts = "unknown"
return_type_runtime = "Any"

[[opcode.params]]
name = "left"
type_ts = "unknown"
type_runtime = "Any"
description = "First value"

[[opcode.params]]
name = "right"
type_ts = "unknown"
type_runtime = "Any"
description = "Second value"

[[opcode.params]]
name = "...rest"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Additional values"
optional = true

# ============================================================================
# json library - JSON operations
# ============================================================================

[[opcode]]
name = "json.stringify"
category = "json"
description = "Converts a value to a JSON string"
label = "Stringify"
return_type_ts = "string"
return_type_runtime = "String"

[[opcode.params]]
name = "value"
type_ts = "unknown"
type_runtime = "Any"
description = "Value to serialize"

[[opcode]]
name = "json.parse"
category = "json"
description = "Parses a JSON string into a value"
label = "Parse"
return_type_ts = "unknown"
return_type_runtime = "Any"

[[opcode.params]]
name = "json"
type_ts = "string"
type_runtime = "String"
description = "JSON string to parse"

# ============================================================================
# game library - Game world operations
# ============================================================================

[[opcode]]
name = "entity"
category = "game"
description = "Gets an entity by its ID"
label = "Entity"
return_type_ts = "Entity"
return_type_runtime = "Object"

[[opcode.params]]
name = "id"
type_ts = "number"
type_runtime = "Number"
description = "Entity ID"

[[opcode]]
name = "verbs"
category = "game"
description = "Gets all verbs defined on an entity"
label = "Verbs"
return_type_ts = "Verb[]"
return_type_runtime = "Array"

[[opcode.params]]
name = "entity"
type_ts = "Entity"
type_runtime = "Object"
description = "Entity to get verbs from"

[[opcode]]
name = "capability"
category = "game"
description = "Gets a capability by its ID"
label = "Capability"
return_type_ts = "Capability"
return_type_runtime = "Object"

[[opcode.params]]
name = "id"
type_ts = "number"
type_runtime = "Number"
description = "Capability ID"

[[opcode]]
name = "update"
category = "game"
description = "Updates entity properties"
label = "Update"
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "entityId"
type_ts = "number"
type_runtime = "Number"
description = "Entity ID to update"

[[opcode.params]]
name = "updates"
type_ts = "object"
type_runtime = "Object"
description = "Properties to update"

[[opcode]]
name = "create"
category = "game"
description = "Creates a new entity"
label = "Create"
return_type_ts = "Entity"
return_type_runtime = "Object"

[[opcode.params]]
name = "props"
type_ts = "object"
type_runtime = "Object"
description = "Initial properties"

[[opcode.params]]
name = "prototypeId"
type_ts = "number"
type_runtime = "Number"
description = "Optional prototype entity ID"
optional = true

[[opcode]]
name = "call"
category = "game"
description = "Calls a verb on an entity"
label = "Call"
variadic = true
return_type_ts = "unknown"
return_type_runtime = "Any"

[[opcode.params]]
name = "target"
type_ts = "Entity"
type_runtime = "Object"
description = "Target entity"

[[opcode.params]]
name = "verb"
type_ts = "string"
type_runtime = "String"
description = "Verb name to call"

[[opcode.params]]
name = "...args"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Arguments to pass to the verb"
optional = true

[[opcode]]
name = "schedule"
category = "game"
description = "Schedules a verb call for future execution"
label = "Schedule"
return_type_ts = "void"
return_type_runtime = "Null"

[[opcode.params]]
name = "verb"
type_ts = "string"
type_runtime = "String"
description = "Verb name to call"

[[opcode.params]]
name = "args"
type_ts = "unknown[]"
type_runtime = "Array"
description = "Arguments to pass to the verb"

[[opcode.params]]
name = "delay"
type_ts = "number"
type_runtime = "Number"
description = "Delay in milliseconds"

[[opcode]]
name = "mint"
category = "game"
description = "Mints a new capability"
label = "Mint"
return_type_ts = "Capability"
return_type_runtime = "Object"

[[opcode.params]]
name = "authority"
type_ts = "Capability"
type_runtime = "Object"
description = "Authority capability"

[[opcode.params]]
name = "capType"
type_ts = "string"
type_runtime = "String"
description = "Capability type"

[[opcode.params]]
name = "params"
type_ts = "object"
type_runtime = "Object"
description = "Capability parameters"

[[opcode]]
name = "delegate"
category = "game"
description = "Delegates a capability with additional restrictions"
label = "Delegate"
return_type_ts = "Capability"
return_type_runtime = "Object"

[[opcode.params]]
name = "parentCap"
type_ts = "Capability"
type_runtime = "Object"
description = "Parent capability to delegate"

[[opcode.params]]
name = "restrictions"
type_ts = "object"
type_runtime = "Object"
description = "Additional restrictions"
